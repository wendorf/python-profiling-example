<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<style>
.r1 {font-style: italic}
.r2 {font-weight: bold}
.r3 {color: #000080; text-decoration-color: #000080; font-weight: bold}
.r4 {color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold}
.r5 {color: #000080; text-decoration-color: #000080; font-weight: bold; font-style: italic}
.r6 {color: #7f7f7f; text-decoration-color: #7f7f7f}
.r7 {color: #000080; text-decoration-color: #000080}
.r8 {color: #3d7b7b; text-decoration-color: #3d7b7b; background-color: #f8f8f8; font-style: italic}
.r9 {background-color: #f8f8f8}
.r10 {color: #ba2121; text-decoration-color: #ba2121; background-color: #f8f8f8; font-style: italic}
.r11 {color: #008000; text-decoration-color: #008000; background-color: #f8f8f8; font-weight: bold}
.r12 {color: #bbbbbb; text-decoration-color: #bbbbbb; background-color: #f8f8f8}
.r13 {color: #0000ff; text-decoration-color: #0000ff; background-color: #f8f8f8; font-weight: bold}
.r14 {color: #000000; text-decoration-color: #000000; background-color: #f8f8f8}
.r15 {color: #19177c; text-decoration-color: #19177c; background-color: #f8f8f8}
.r16 {color: #666666; text-decoration-color: #666666; background-color: #f8f8f8}
.r17 {color: #ba2121; text-decoration-color: #ba2121; background-color: #f8f8f8}
.r18 {color: #800000; text-decoration-color: #800000; font-weight: bold}
.r19 {color: #0000ff; text-decoration-color: #0000ff; background-color: #f8f8f8}
.r20 {color: #aa22ff; text-decoration-color: #aa22ff; background-color: #f8f8f8; font-weight: bold}
.r21 {color: #008000; text-decoration-color: #008000; background-color: #f8f8f8}
.r22 {color: #aa22ff; text-decoration-color: #aa22ff; background-color: #f8f8f8}
.r23 {color: #a45a77; text-decoration-color: #a45a77; background-color: #f8f8f8; font-weight: bold}
.r24 {color: #cb3f38; text-decoration-color: #cb3f38; background-color: #f8f8f8; font-weight: bold}
.r25 {font-weight: bold; font-style: italic}
.r26 {color: #000080; text-decoration-color: #000080; text-decoration: underline}
body {
    color: #000000;
    background-color: #ffffff;
}
</style>
</head>
<body>
    <pre style="font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><code style="font-family:inherit"><span class="r1">                    /opt/render/project/src/wrapper-app.py: % of time =  66.21% (1m:26.837s) out of 2m:11.158s.                    </span>
        ╷        ╷       ╷       ╷                                                                                                 
 <span class="r2">       </span>│<span class="r3">Time</span><span class="r2">    </span>│<span class="r3">––––––</span><span class="r2"> </span>│<span class="r3">––––––</span><span class="r2"> </span>│<span class="r2">                                                                                                </span> 
 <span class="r2"> </span><span class="r4">Line</span><span class="r2">  </span>│<span class="r5">Python</span><span class="r2">  </span>│<span class="r5">native</span><span class="r2"> </span>│<span class="r5">system</span><span class="r2"> </span>│<span class="r2">/opt/render/project/src/wrapper-app.py                                                          </span> 
╺━━━━━━━┿━━━━━━━━┿━━━━━━━┿━━━━━━━┿━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╸
 <span class="r6">     1 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8">#!/usr/bin/env python</span><span class="r9">                                                                          </span>  
 <span class="r6">     2 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">&quot;&quot;&quot;</span><span class="r9">                                                                                            </span>  
 <span class="r6">     3 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">Wrapper script to run the Flask app with Gunicorn.</span><span class="r9">                                             </span>  
 <span class="r6">     4 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">     5 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">This allows you to profile the real production setup with Scalene:</span><span class="r9">                             </span>  
 <span class="r6">     6 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">    scalene --cpu --html --profile-interval=15 --outfile=/tmp/scalene.html wrapper-app.py</span><span class="r9">      </span>  
 <span class="r6">     7 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">     8 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">Instead of just profiling Flask&#x27;s dev server:</span><span class="r9">                                                  </span>  
 <span class="r6">     9 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">    scalene app.py</span><span class="r9">                                                                             </span>  
 <span class="r6">    10 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    11 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">This is equivalent to running: gunicorn app:app</span><span class="r9">                                                </span>  
 <span class="r6">    12 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r10">&quot;&quot;&quot;</span><span class="r9">                                                                                            </span>  
 <span class="r6">    13 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">import</span><span class="r12"> </span><span class="r13">sys</span><span class="r9">                                                                                     </span>  
 <span class="r6">    14 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">from</span><span class="r12"> </span><span class="r13">gunicorn.app.wsgiapp</span><span class="r12"> </span><span class="r11">import</span><span class="r14"> run</span><span class="r9">                                                           </span>  
 <span class="r6">    15 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    16 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">if</span><span class="r14"> </span><span class="r15">__name__</span><span class="r14"> </span><span class="r16">==</span><span class="r14"> </span><span class="r17">&quot;__main__&quot;</span><span class="r14">:</span><span class="r9">                                                                     </span>  
 <span class="r6">    17 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    </span><span class="r8"># Mimic: gunicorn app:app</span><span class="r9">                                                                  </span>  
 <span class="r6">    18 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    </span><span class="r8"># Pass through any additional args (e.g., --workers 4)</span><span class="r9">                                     </span>  
 <span class="r6">    19 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    sys</span><span class="r16">.</span><span class="r14">argv </span><span class="r16">=</span><span class="r14"> [</span><span class="r17">&quot;gunicorn&quot;</span><span class="r14">, </span><span class="r17">&quot;app:app&quot;</span><span class="r14">] </span><span class="r16">+</span><span class="r14"> sys</span><span class="r16">.</span><span class="r14">argv[</span><span class="r16">1</span><span class="r14">:]</span><span class="r9">                                          </span>  
 <span class="r6">    20 </span>│<span class="r18">    4%</span><span class="r7">  </span>│<span class="r7">       </span>│<span class="r7">  62%  </span>│<span class="r14">    run()</span><span class="r9">                                                                                      </span>  
 <span class="r6">    21 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
        ╵        ╵       ╵       ╵                                                                                                 
<span class="r1">                         /opt/render/project/src/app.py: % of time =  33.79% (44.321s) out of 2m:11.158s.                          </span>
        ╷        ╷       ╷       ╷                                                                                                 
 <span class="r2">       </span>│<span class="r3">Time</span><span class="r2">    </span>│<span class="r3">––––––</span><span class="r2"> </span>│<span class="r3">––––––</span><span class="r2"> </span>│<span class="r2">                                                                                                </span> 
 <span class="r2"> </span><span class="r4">Line</span><span class="r2">  </span>│<span class="r5">Python</span><span class="r2">  </span>│<span class="r5">native</span><span class="r2"> </span>│<span class="r5">system</span><span class="r2"> </span>│<span class="r2">/opt/render/project/src/app.py                                                                  </span> 
╺━━━━━━━┿━━━━━━━━┿━━━━━━━┿━━━━━━━┿━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╸
 <span class="r6">     1 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">import</span><span class="r12"> </span><span class="r13">io</span><span class="r9">                                                                                      </span>  
 <span class="r6">     2 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">import</span><span class="r12"> </span><span class="r13">time</span><span class="r9">                                                                                    </span>  
 <span class="r6">     3 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">from</span><span class="r12"> </span><span class="r13">flask</span><span class="r12"> </span><span class="r11">import</span><span class="r14"> Flask, request, send_file, render_template_string, jsonify</span><span class="r9">                   </span>  
 <span class="r6">     4 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">from</span><span class="r12"> </span><span class="r13">PIL</span><span class="r12"> </span><span class="r11">import</span><span class="r14"> Image, ImageFilter, ImageEnhance</span><span class="r9">                                               </span>  
 <span class="r6">     5 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">import</span><span class="r12"> </span><span class="r13">numpy</span><span class="r12"> </span><span class="r11">as</span><span class="r12"> </span><span class="r13">np</span><span class="r9">                                                                             </span>  
 <span class="r6">     6 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">     7 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">app </span><span class="r16">=</span><span class="r14"> Flask(</span><span class="r15">__name__</span><span class="r14">)</span><span class="r9">                                                                          </span>  
 <span class="r6">     8 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">     9 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r8"># HTML template for the upload form</span><span class="r9">                                                            </span>  
 <span class="r6">    10 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">HTML_TEMPLATE </span><span class="r16">=</span><span class="r14"> </span><span class="r17">&quot;&quot;&quot;</span><span class="r9">                                                                            </span>  
 <span class="r6">    11 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">&lt;!DOCTYPE html&gt;</span><span class="r9">                                                                                </span>  
 <span class="r6">    12 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">&lt;html&gt;</span><span class="r9">                                                                                         </span>  
 <span class="r6">    13 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">&lt;head&gt;</span><span class="r9">                                                                                         </span>  
 <span class="r6">    14 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">    &lt;title&gt;Image Processor - Profiling Example&lt;/title&gt;</span><span class="r9">                                         </span>  
 <span class="r6">    15 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">    &lt;style&gt;</span><span class="r9">                                                                                    </span>  
 <span class="r6">    16 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">        body { font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; padding: 20</span>  
 <span class="r6">    17 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">        h1 { color: #333; }</span><span class="r9">                                                                    </span>  
 <span class="r6">    18 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">        .upload-form { background: #f5f5f5; padding: 20px; border-radius: 8px; margin: 20px 0; </span>  
 <span class="r6">    19 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-ra</span>  
 <span class="r6">    20 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">        button:hover { background: #0056b3; }</span><span class="r9">                                                  </span>  
 <span class="r6">    21 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">        .info { background: #e7f3ff; padding: 15px; border-radius: 4px; margin: 20px 0; }</span><span class="r9">      </span>  
 <span class="r6">    22 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">        .operations { margin: 20px 0; }</span><span class="r9">                                                        </span>  
 <span class="r6">    23 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">        label { display: block; margin: 10px 0 5px 0; }</span><span class="r9">                                        </span>  
 <span class="r6">    24 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">    &lt;/style&gt;</span><span class="r9">                                                                                   </span>  
 <span class="r6">    25 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">&lt;/head&gt;</span><span class="r9">                                                                                        </span>  
 <span class="r6">    26 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">&lt;body&gt;</span><span class="r9">                                                                                         </span>  
 <span class="r6">    27 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">    &lt;h1&gt;Image Processing Service&lt;/h1&gt;</span><span class="r9">                                                          </span>  
 <span class="r6">    28 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">    &lt;div class=&quot;info&quot;&gt;</span><span class="r9">                                                                         </span>  
 <span class="r6">    29 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">        &lt;h3&gt;Available Operations:&lt;/h3&gt;</span><span class="r9">                                                         </span>  
 <span class="r6">    30 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">        &lt;ul&gt;</span><span class="r9">                                                                                   </span>  
 <span class="r6">    31 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">            &lt;li&gt;&lt;strong&gt;blur&lt;/strong&gt; - Apply Gaussian blur&lt;/li&gt;</span><span class="r9">                               </span>  
 <span class="r6">    32 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">            &lt;li&gt;&lt;strong&gt;sharpen&lt;/strong&gt; - Sharpen the image&lt;/li&gt;</span><span class="r9">                              </span>  
 <span class="r6">    33 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">            &lt;li&gt;&lt;strong&gt;edge_detect&lt;/strong&gt; - Detect edges&lt;/li&gt;</span><span class="r9">                               </span>  
 <span class="r6">    34 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">            &lt;li&gt;&lt;strong&gt;grayscale&lt;/strong&gt; - Convert to grayscale&lt;/li&gt;</span><span class="r9">                         </span>  
 <span class="r6">    35 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">            &lt;li&gt;&lt;strong&gt;enhance&lt;/strong&gt; - Enhance colors and contrast&lt;/li&gt;</span><span class="r9">                    </span>  
 <span class="r6">    36 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">            &lt;li&gt;&lt;strong&gt;rotate&lt;/strong&gt; - Rotate and apply transformations&lt;/li&gt;</span><span class="r9">                </span>  
 <span class="r6">    37 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">            &lt;li&gt;&lt;strong&gt;noise_reduction&lt;/strong&gt; - CPU-intensive noise reduction&lt;/li&gt;</span><span class="r9">          </span>  
 <span class="r6">    38 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">        &lt;/ul&gt;</span><span class="r9">                                                                                  </span>  
 <span class="r6">    39 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">    &lt;/div&gt;</span><span class="r9">                                                                                     </span>  
 <span class="r6">    40 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    41 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">    &lt;div class=&quot;upload-form&quot;&gt;</span><span class="r9">                                                                  </span>  
 <span class="r6">    42 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">        &lt;h3&gt;Upload and Process Image&lt;/h3&gt;</span><span class="r9">                                                      </span>  
 <span class="r6">    43 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">        &lt;form action=&quot;/process&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span><span class="r9">                   </span>  
 <span class="r6">    44 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">            &lt;label for=&quot;image&quot;&gt;Select Image:&lt;/label&gt;</span><span class="r9">                                           </span>  
 <span class="r6">    45 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">            &lt;input type=&quot;file&quot; name=&quot;image&quot; id=&quot;image&quot; accept=&quot;image/*&quot; required&gt;</span><span class="r9">              </span>  
 <span class="r6">    46 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    47 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">            &lt;label for=&quot;operation&quot;&gt;Operation:&lt;/label&gt;</span><span class="r9">                                          </span>  
 <span class="r6">    48 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">            &lt;select name=&quot;operation&quot; id=&quot;operation&quot;&gt;</span><span class="r9">                                           </span>  
 <span class="r6">    49 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">                &lt;option value=&quot;blur&quot;&gt;Blur&lt;/option&gt;</span><span class="r9">                                             </span>  
 <span class="r6">    50 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">                &lt;option value=&quot;sharpen&quot;&gt;Sharpen&lt;/option&gt;</span><span class="r9">                                       </span>  
 <span class="r6">    51 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">                &lt;option value=&quot;edge_detect&quot;&gt;Edge Detect&lt;/option&gt;</span><span class="r9">                               </span>  
 <span class="r6">    52 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">                &lt;option value=&quot;grayscale&quot;&gt;Grayscale&lt;/option&gt;</span><span class="r9">                                   </span>  
 <span class="r6">    53 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">                &lt;option value=&quot;enhance&quot;&gt;Enhance&lt;/option&gt;</span><span class="r9">                                       </span>  
 <span class="r6">    54 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">                &lt;option value=&quot;rotate&quot;&gt;Rotate&lt;/option&gt;</span><span class="r9">                                         </span>  
 <span class="r6">    55 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">                &lt;option value=&quot;noise_reduction&quot;&gt;Noise Reduction (CPU intensive)&lt;/option&gt;</span><span class="r9">       </span>  
 <span class="r6">    56 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">            &lt;/select&gt;</span><span class="r9">                                                                          </span>  
 <span class="r6">    57 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    58 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">            &lt;br&gt;&lt;br&gt;</span><span class="r9">                                                                           </span>  
 <span class="r6">    59 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">            &lt;button type=&quot;submit&quot;&gt;Process Image&lt;/button&gt;</span><span class="r9">                                       </span>  
 <span class="r6">    60 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">        &lt;/form&gt;</span><span class="r9">                                                                                </span>  
 <span class="r6">    61 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">    &lt;/div&gt;</span><span class="r9">                                                                                     </span>  
 <span class="r6">    62 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    63 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">    &lt;div class=&quot;info&quot;&gt;</span><span class="r9">                                                                         </span>  
 <span class="r6">    64 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">        &lt;h3&gt;Health Check:&lt;/h3&gt;</span><span class="r9">                                                                 </span>  
 <span class="r6">    65 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">        &lt;p&gt;Visit &lt;a href=&quot;/health&quot;&gt;/health&lt;/a&gt; for service status&lt;/p&gt;</span><span class="r9">                          </span>  
 <span class="r6">    66 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">    &lt;/div&gt;</span><span class="r9">                                                                                     </span>  
 <span class="r6">    67 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">&lt;/body&gt;</span><span class="r9">                                                                                        </span>  
 <span class="r6">    68 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">&lt;/html&gt;</span><span class="r9">                                                                                        </span>  
 <span class="r6">    69 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r17">&quot;&quot;&quot;</span><span class="r9">                                                                                            </span>  
 <span class="r6">    70 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    71 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    72 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">def</span><span class="r12"> </span><span class="r19">apply_blur</span><span class="r14">(image):</span><span class="r9">                                                                         </span>  
 <span class="r6">    73 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r12">    </span><span class="r10">&quot;&quot;&quot;Apply Gaussian blur - moderate CPU/memory usage&quot;&quot;&quot;</span><span class="r9">                                      </span>  
 <span class="r6">    74 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    </span><span class="r11">return</span><span class="r14"> image</span><span class="r16">.</span><span class="r14">filter(ImageFilter</span><span class="r16">.</span><span class="r14">GaussianBlur(radius</span><span class="r16">=5</span><span class="r14">))</span><span class="r9">                                    </span>  
 <span class="r6">    75 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    76 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    77 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">def</span><span class="r12"> </span><span class="r19">apply_sharpen</span><span class="r14">(image):</span><span class="r9">                                                                      </span>  
 <span class="r6">    78 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r12">    </span><span class="r10">&quot;&quot;&quot;Sharpen image - light processing&quot;&quot;&quot;</span><span class="r9">                                                     </span>  
 <span class="r6">    79 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    </span><span class="r11">return</span><span class="r14"> image</span><span class="r16">.</span><span class="r14">filter(ImageFilter</span><span class="r16">.</span><span class="r14">SHARPEN)</span><span class="r9">                                                   </span>  
 <span class="r6">    80 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    81 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    82 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">def</span><span class="r12"> </span><span class="r19">apply_edge_detect</span><span class="r14">(image):</span><span class="r9">                                                                  </span>  
 <span class="r6">    83 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r12">    </span><span class="r10">&quot;&quot;&quot;Edge detection - moderate processing&quot;&quot;&quot;</span><span class="r9">                                                 </span>  
 <span class="r6">    84 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    </span><span class="r11">return</span><span class="r14"> image</span><span class="r16">.</span><span class="r14">filter(ImageFilter</span><span class="r16">.</span><span class="r14">FIND_EDGES)</span><span class="r9">                                                </span>  
 <span class="r6">    85 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    86 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    87 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">def</span><span class="r12"> </span><span class="r19">apply_grayscale</span><span class="r14">(image):</span><span class="r9">                                                                    </span>  
 <span class="r6">    88 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r12">    </span><span class="r10">&quot;&quot;&quot;Convert to grayscale - light processing&quot;&quot;&quot;</span><span class="r9">                                              </span>  
 <span class="r6">    89 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    </span><span class="r11">return</span><span class="r14"> image</span><span class="r16">.</span><span class="r14">convert(</span><span class="r17">&#x27;L&#x27;</span><span class="r14">)</span><span class="r9">                                                                  </span>  
 <span class="r6">    90 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    91 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    92 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">def</span><span class="r12"> </span><span class="r19">apply_enhance</span><span class="r14">(image):</span><span class="r9">                                                                      </span>  
 <span class="r6">    93 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r12">    </span><span class="r10">&quot;&quot;&quot;Enhance colors and contrast - moderate processing&quot;&quot;&quot;</span><span class="r9">                                    </span>  
 <span class="r6">    94 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    </span><span class="r8"># Increase color saturation</span><span class="r9">                                                                </span>  
 <span class="r6">    95 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    enhancer </span><span class="r16">=</span><span class="r14"> ImageEnhance</span><span class="r16">.</span><span class="r14">Color(image)</span><span class="r9">                                                       </span>  
 <span class="r6">    96 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    image </span><span class="r16">=</span><span class="r14"> enhancer</span><span class="r16">.</span><span class="r14">enhance(</span><span class="r16">1.5</span><span class="r14">)</span><span class="r9">                                                              </span>  
 <span class="r6">    97 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">    98 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    </span><span class="r8"># Increase contrast</span><span class="r9">                                                                        </span>  
 <span class="r6">    99 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    enhancer </span><span class="r16">=</span><span class="r14"> ImageEnhance</span><span class="r16">.</span><span class="r14">Contrast(image)</span><span class="r9">                                                    </span>  
 <span class="r6">   100 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    image </span><span class="r16">=</span><span class="r14"> enhancer</span><span class="r16">.</span><span class="r14">enhance(</span><span class="r16">1.3</span><span class="r14">)</span><span class="r9">                                                              </span>  
 <span class="r6">   101 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   102 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    </span><span class="r8"># Increase sharpness</span><span class="r9">                                                                       </span>  
 <span class="r6">   103 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    enhancer </span><span class="r16">=</span><span class="r14"> ImageEnhance</span><span class="r16">.</span><span class="r14">Sharpness(image)</span><span class="r9">                                                   </span>  
 <span class="r6">   104 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    image </span><span class="r16">=</span><span class="r14"> enhancer</span><span class="r16">.</span><span class="r14">enhance(</span><span class="r16">1.2</span><span class="r14">)</span><span class="r9">                                                              </span>  
 <span class="r6">   105 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   106 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    </span><span class="r11">return</span><span class="r14"> image</span><span class="r9">                                                                               </span>  
 <span class="r6">   107 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   108 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   109 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">def</span><span class="r12"> </span><span class="r19">apply_rotate</span><span class="r14">(image):</span><span class="r9">                                                                       </span>  
 <span class="r6">   110 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r12">    </span><span class="r10">&quot;&quot;&quot;Rotate and transform - memory intensive&quot;&quot;&quot;</span><span class="r9">                                              </span>  
 <span class="r6">   111 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    </span><span class="r8"># Multiple rotations and transformations</span><span class="r9">                                                   </span>  
 <span class="r6">   112 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    result </span><span class="r16">=</span><span class="r14"> image</span><span class="r16">.</span><span class="r14">rotate(</span><span class="r16">45</span><span class="r14">, expand</span><span class="r16">=</span><span class="r11">True</span><span class="r14">)</span><span class="r9">                                                     </span>  
 <span class="r6">   113 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    result </span><span class="r16">=</span><span class="r14"> result</span><span class="r16">.</span><span class="r14">rotate(</span><span class="r16">-45</span><span class="r14">, expand</span><span class="r16">=</span><span class="r11">True</span><span class="r14">)</span><span class="r9">                                                   </span>  
 <span class="r6">   114 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    result </span><span class="r16">=</span><span class="r14"> result</span><span class="r16">.</span><span class="r14">transpose(Image</span><span class="r16">.</span><span class="r14">FLIP_LEFT_RIGHT)</span><span class="r9">                                           </span>  
 <span class="r6">   115 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    </span><span class="r11">return</span><span class="r14"> result</span><span class="r9">                                                                              </span>  
 <span class="r6">   116 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   117 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   118 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">def</span><span class="r12"> </span><span class="r19">apply_noise_reduction</span><span class="r14">(image):</span><span class="r9">                                                              </span>  
 <span class="r6">   119 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r12">    </span><span class="r10">&quot;&quot;&quot;CPU-intensive noise reduction using numpy&quot;&quot;&quot;</span><span class="r9">                                            </span>  
 <span class="r6">   120 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    </span><span class="r8"># Convert to numpy array for mathematical operations</span><span class="r9">                                       </span>  
 <span class="r6">   121 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    img_array </span><span class="r16">=</span><span class="r14"> np</span><span class="r16">.</span><span class="r14">array(image)</span><span class="r9">                                                                </span>  
 <span class="r6">   122 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   123 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    </span><span class="r8"># Simulate noise reduction with multiple passes</span><span class="r9">                                            </span>  
 <span class="r6">   124 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    </span><span class="r8"># This is intentionally CPU-intensive for profiling purposes</span><span class="r9">                               </span>  
 <span class="r6">   125 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    result </span><span class="r16">=</span><span class="r14"> img_array</span><span class="r16">.</span><span class="r14">astype(np</span><span class="r16">.</span><span class="r14">float32)</span><span class="r9">                                                      </span>  
 <span class="r6">   126 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   127 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    </span><span class="r8"># Apply multiple smoothing passes</span><span class="r9">                                                          </span>  
 <span class="r6">   128 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    </span><span class="r11">for</span><span class="r14"> _ </span><span class="r20">in</span><span class="r14"> </span><span class="r21">range</span><span class="r14">(</span><span class="r16">3</span><span class="r14">):</span><span class="r9">                                                                         </span>  
 <span class="r6">   129 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">        </span><span class="r8"># Simple box filter implementation</span><span class="r9">                                                     </span>  
 <span class="r6">   130 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">        kernel_size </span><span class="r16">=</span><span class="r14"> </span><span class="r16">3</span><span class="r9">                                                                        </span>  
 <span class="r6">   131 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">        padded </span><span class="r16">=</span><span class="r14"> np</span><span class="r16">.</span><span class="r14">pad(result, ((kernel_size</span><span class="r16">//2</span><span class="r14">, kernel_size</span><span class="r16">//2</span><span class="r14">),</span><span class="r9">                             </span>  
 <span class="r6">   132 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">                                  (kernel_size</span><span class="r16">//2</span><span class="r14">, kernel_size</span><span class="r16">//2</span><span class="r14">),</span><span class="r9">                            </span>  
 <span class="r6">   133 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">                                  (</span><span class="r16">0</span><span class="r14">, </span><span class="r16">0</span><span class="r14">)), mode</span><span class="r16">=</span><span class="r17">&#x27;edge&#x27;</span><span class="r14">)</span><span class="r9">                                        </span>  
 <span class="r6">   134 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   135 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">        output </span><span class="r16">=</span><span class="r14"> np</span><span class="r16">.</span><span class="r14">zeros_like(result)</span><span class="r9">                                                         </span>  
 <span class="r6">   136 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">        </span><span class="r11">for</span><span class="r14"> i </span><span class="r20">in</span><span class="r14"> </span><span class="r21">range</span><span class="r14">(result</span><span class="r16">.</span><span class="r14">shape[</span><span class="r16">0</span><span class="r14">]):</span><span class="r9">                                                       </span>  
 <span class="r6">   137 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">            </span><span class="r11">for</span><span class="r14"> j </span><span class="r20">in</span><span class="r14"> </span><span class="r21">range</span><span class="r14">(result</span><span class="r16">.</span><span class="r14">shape[</span><span class="r16">1</span><span class="r14">]):</span><span class="r9">                                                   </span>  
 <span class="r6">   138 </span>│<span class="r18">   28%</span><span class="r7">  </span>│<span class="r7">       </span>│<span class="r7">   5%  </span>│<span class="r14">                output[i, j] </span><span class="r16">=</span><span class="r14"> np</span><span class="r16">.</span><span class="r14">mean(</span><span class="r9">                                                        </span>  
 <span class="r6">   139 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">                    padded[i:i</span><span class="r16">+</span><span class="r14">kernel_size, j:j</span><span class="r16">+</span><span class="r14">kernel_size],</span><span class="r9">                                  </span>  
 <span class="r6">   140 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">                    axis</span><span class="r16">=</span><span class="r14">(</span><span class="r16">0</span><span class="r14">, </span><span class="r16">1</span><span class="r14">)</span><span class="r9">                                                                </span>  
 <span class="r6">   141 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">                )</span><span class="r9">                                                                              </span>  
 <span class="r6">   142 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">        result </span><span class="r16">=</span><span class="r14"> output</span><span class="r9">                                                                        </span>  
 <span class="r6">   143 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   144 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    </span><span class="r8"># Convert back to uint8</span><span class="r9">                                                                    </span>  
 <span class="r6">   145 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    result </span><span class="r16">=</span><span class="r14"> np</span><span class="r16">.</span><span class="r14">clip(result, </span><span class="r16">0</span><span class="r14">, </span><span class="r16">255</span><span class="r14">)</span><span class="r16">.</span><span class="r14">astype(np</span><span class="r16">.</span><span class="r14">uint8)</span><span class="r9">                                          </span>  
 <span class="r6">   146 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    </span><span class="r11">return</span><span class="r14"> Image</span><span class="r16">.</span><span class="r14">fromarray(result)</span><span class="r9">                                                             </span>  
 <span class="r6">   147 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   148 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   149 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">OPERATIONS </span><span class="r16">=</span><span class="r14"> {</span><span class="r9">                                                                                 </span>  
 <span class="r6">   150 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    </span><span class="r17">&#x27;blur&#x27;</span><span class="r14">: apply_blur,</span><span class="r9">                                                                        </span>  
 <span class="r6">   151 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    </span><span class="r17">&#x27;sharpen&#x27;</span><span class="r14">: apply_sharpen,</span><span class="r9">                                                                  </span>  
 <span class="r6">   152 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    </span><span class="r17">&#x27;edge_detect&#x27;</span><span class="r14">: apply_edge_detect,</span><span class="r9">                                                          </span>  
 <span class="r6">   153 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    </span><span class="r17">&#x27;grayscale&#x27;</span><span class="r14">: apply_grayscale,</span><span class="r9">                                                              </span>  
 <span class="r6">   154 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    </span><span class="r17">&#x27;enhance&#x27;</span><span class="r14">: apply_enhance,</span><span class="r9">                                                                  </span>  
 <span class="r6">   155 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    </span><span class="r17">&#x27;rotate&#x27;</span><span class="r14">: apply_rotate,</span><span class="r9">                                                                    </span>  
 <span class="r6">   156 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    </span><span class="r17">&#x27;noise_reduction&#x27;</span><span class="r14">: apply_noise_reduction,</span><span class="r9">                                                  </span>  
 <span class="r6">   157 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">}</span><span class="r9">                                                                                              </span>  
 <span class="r6">   158 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   159 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   160 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r22">@app</span><span class="r16">.</span><span class="r14">route(</span><span class="r17">&#x27;/&#x27;</span><span class="r14">)</span><span class="r9">                                                                                </span>  
 <span class="r6">   161 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">def</span><span class="r12"> </span><span class="r19">index</span><span class="r14">():</span><span class="r9">                                                                                   </span>  
 <span class="r6">   162 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r12">    </span><span class="r10">&quot;&quot;&quot;Home page with upload form&quot;&quot;&quot;</span><span class="r9">                                                           </span>  
 <span class="r6">   163 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    </span><span class="r11">return</span><span class="r14"> render_template_string(HTML_TEMPLATE)</span><span class="r9">                                               </span>  
 <span class="r6">   164 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   165 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   166 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r22">@app</span><span class="r16">.</span><span class="r14">route(</span><span class="r17">&#x27;/health&#x27;</span><span class="r14">)</span><span class="r9">                                                                          </span>  
 <span class="r6">   167 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">def</span><span class="r12"> </span><span class="r19">health</span><span class="r14">():</span><span class="r9">                                                                                  </span>  
 <span class="r6">   168 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r12">    </span><span class="r10">&quot;&quot;&quot;Health check endpoint&quot;&quot;&quot;</span><span class="r9">                                                                </span>  
 <span class="r6">   169 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    </span><span class="r11">return</span><span class="r14"> jsonify({</span><span class="r9">                                                                           </span>  
 <span class="r6">   170 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">        </span><span class="r17">&#x27;status&#x27;</span><span class="r14">: </span><span class="r17">&#x27;healthy&#x27;</span><span class="r14">,</span><span class="r9">                                                                   </span>  
 <span class="r6">   171 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">        </span><span class="r17">&#x27;service&#x27;</span><span class="r14">: </span><span class="r17">&#x27;image-processor&#x27;</span><span class="r14">,</span><span class="r9">                                                          </span>  
 <span class="r6">   172 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">        </span><span class="r17">&#x27;timestamp&#x27;</span><span class="r14">: time</span><span class="r16">.</span><span class="r14">time()</span><span class="r9">                                                               </span>  
 <span class="r6">   173 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    })</span><span class="r9">                                                                                         </span>  
 <span class="r6">   174 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   175 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   176 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r22">@app</span><span class="r16">.</span><span class="r14">route(</span><span class="r17">&#x27;/process&#x27;</span><span class="r14">, methods</span><span class="r16">=</span><span class="r14">[</span><span class="r17">&#x27;POST&#x27;</span><span class="r14">])</span><span class="r9">                                                       </span>  
 <span class="r6">   177 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">def</span><span class="r12"> </span><span class="r19">process_image</span><span class="r14">():</span><span class="r9">                                                                           </span>  
 <span class="r6">   178 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r12">    </span><span class="r10">&quot;&quot;&quot;Process uploaded image with specified operation&quot;&quot;&quot;</span><span class="r9">                                      </span>  
 <span class="r6">   179 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    start_time </span><span class="r16">=</span><span class="r14"> time</span><span class="r16">.</span><span class="r14">time()</span><span class="r9">                                                                   </span>  
 <span class="r6">   180 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   181 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    </span><span class="r8"># Validate request</span><span class="r9">                                                                         </span>  
 <span class="r6">   182 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    </span><span class="r11">if</span><span class="r14"> </span><span class="r17">&#x27;image&#x27;</span><span class="r14"> </span><span class="r20">not</span><span class="r14"> </span><span class="r20">in</span><span class="r14"> request</span><span class="r16">.</span><span class="r14">files:</span><span class="r9">                                                           </span>  
 <span class="r6">   183 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">        </span><span class="r11">return</span><span class="r14"> jsonify({</span><span class="r17">&#x27;error&#x27;</span><span class="r14">: </span><span class="r17">&#x27;No image provided&#x27;</span><span class="r14">}), </span><span class="r16">400</span><span class="r9">                                    </span>  
 <span class="r6">   184 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   185 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    file </span><span class="r16">=</span><span class="r14"> request</span><span class="r16">.</span><span class="r14">files[</span><span class="r17">&#x27;image&#x27;</span><span class="r14">]</span><span class="r9">                                                              </span>  
 <span class="r6">   186 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    </span><span class="r11">if</span><span class="r14"> file</span><span class="r16">.</span><span class="r14">filename </span><span class="r16">==</span><span class="r14"> </span><span class="r17">&#x27;&#x27;</span><span class="r14">:</span><span class="r9">                                                                    </span>  
 <span class="r6">   187 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">        </span><span class="r11">return</span><span class="r14"> jsonify({</span><span class="r17">&#x27;error&#x27;</span><span class="r14">: </span><span class="r17">&#x27;No image selected&#x27;</span><span class="r14">}), </span><span class="r16">400</span><span class="r9">                                    </span>  
 <span class="r6">   188 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   189 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    operation </span><span class="r16">=</span><span class="r14"> request</span><span class="r16">.</span><span class="r14">form</span><span class="r16">.</span><span class="r14">get(</span><span class="r17">&#x27;operation&#x27;</span><span class="r14">, </span><span class="r17">&#x27;blur&#x27;</span><span class="r14">)</span><span class="r9">                                          </span>  
 <span class="r6">   190 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   191 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    </span><span class="r11">if</span><span class="r14"> operation </span><span class="r20">not</span><span class="r14"> </span><span class="r20">in</span><span class="r14"> OPERATIONS:</span><span class="r9">                                                            </span>  
 <span class="r6">   192 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">        </span><span class="r11">return</span><span class="r14"> jsonify({</span><span class="r17">&#x27;error&#x27;</span><span class="r14">: </span><span class="r17">f&#x27;Invalid operation: </span><span class="r23">{</span><span class="r14">operation</span><span class="r23">}</span><span class="r17">&#x27;</span><span class="r14">}), </span><span class="r16">400</span><span class="r9">                      </span>  
 <span class="r6">   193 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   194 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    </span><span class="r11">try</span><span class="r14">:</span><span class="r9">                                                                                       </span>  
 <span class="r6">   195 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">        </span><span class="r8"># Read image</span><span class="r9">                                                                           </span>  
 <span class="r6">   196 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">        image </span><span class="r16">=</span><span class="r14"> Image</span><span class="r16">.</span><span class="r14">open(file</span><span class="r16">.</span><span class="r14">stream)</span><span class="r9">                                                        </span>  
 <span class="r6">   197 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   198 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">        </span><span class="r8"># Convert RGBA to RGB if necessary</span><span class="r9">                                                     </span>  
 <span class="r6">   199 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">        </span><span class="r11">if</span><span class="r14"> image</span><span class="r16">.</span><span class="r14">mode </span><span class="r16">==</span><span class="r14"> </span><span class="r17">&#x27;RGBA&#x27;</span><span class="r14">:</span><span class="r9">                                                               </span>  
 <span class="r6">   200 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">            image </span><span class="r16">=</span><span class="r14"> image</span><span class="r16">.</span><span class="r14">convert(</span><span class="r17">&#x27;RGB&#x27;</span><span class="r14">)</span><span class="r9">                                                       </span>  
 <span class="r6">   201 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   202 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">        </span><span class="r8"># Apply operation</span><span class="r9">                                                                      </span>  
 <span class="r6">   203 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">        processed_image </span><span class="r16">=</span><span class="r14"> OPERATIONS[operation](image)</span><span class="r9">                                         </span>  
 <span class="r6">   204 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   205 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">        </span><span class="r8"># Save to bytes</span><span class="r9">                                                                        </span>  
 <span class="r6">   206 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">        output </span><span class="r16">=</span><span class="r14"> io</span><span class="r16">.</span><span class="r14">BytesIO()</span><span class="r9">                                                                  </span>  
 <span class="r6">   207 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">        processed_image</span><span class="r16">.</span><span class="r14">save(output, </span><span class="r21">format</span><span class="r16">=</span><span class="r17">&#x27;JPEG&#x27;</span><span class="r14">, quality</span><span class="r16">=85</span><span class="r14">)</span><span class="r9">                                </span>  
 <span class="r6">   208 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">        output</span><span class="r16">.</span><span class="r14">seek(</span><span class="r16">0</span><span class="r14">)</span><span class="r9">                                                                         </span>  
 <span class="r6">   209 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   210 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">        processing_time </span><span class="r16">=</span><span class="r14"> time</span><span class="r16">.</span><span class="r14">time() </span><span class="r16">-</span><span class="r14"> start_time</span><span class="r9">                                             </span>  
 <span class="r6">   211 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   212 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">        </span><span class="r11">return</span><span class="r14"> send_file(</span><span class="r9">                                                                      </span>  
 <span class="r6">   213 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">            output,</span><span class="r9">                                                                            </span>  
 <span class="r6">   214 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">            mimetype</span><span class="r16">=</span><span class="r17">&#x27;image/jpeg&#x27;</span><span class="r14">,</span><span class="r9">                                                             </span>  
 <span class="r6">   215 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">            as_attachment</span><span class="r16">=</span><span class="r11">True</span><span class="r14">,</span><span class="r9">                                                                </span>  
 <span class="r6">   216 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">            download_name</span><span class="r16">=</span><span class="r17">f&#x27;processed_</span><span class="r23">{</span><span class="r14">operation</span><span class="r23">}</span><span class="r17">.jpg&#x27;</span><span class="r14">,</span><span class="r9">                                        </span>  
 <span class="r6">   217 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">            max_age</span><span class="r16">=0</span><span class="r9">                                                                          </span>  
 <span class="r6">   218 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">        ), </span><span class="r16">200</span><span class="r14">, {</span><span class="r17">&#x27;X-Processing-Time&#x27;</span><span class="r14">: </span><span class="r17">f&#x27;</span><span class="r23">{</span><span class="r14">processing_time</span><span class="r23">:</span><span class="r17">.3f</span><span class="r23">}</span><span class="r17">s&#x27;</span><span class="r14">}</span><span class="r9">                               </span>  
 <span class="r6">   219 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   220 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    </span><span class="r11">except</span><span class="r14"> </span><span class="r24">Exception</span><span class="r14"> </span><span class="r11">as</span><span class="r14"> e:</span><span class="r9">                                                                     </span>  
 <span class="r6">   221 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">        </span><span class="r11">return</span><span class="r14"> jsonify({</span><span class="r17">&#x27;error&#x27;</span><span class="r14">: </span><span class="r21">str</span><span class="r14">(e)}), </span><span class="r16">500</span><span class="r9">                                                 </span>  
 <span class="r6">   222 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   223 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">   224 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r11">if</span><span class="r14"> </span><span class="r15">__name__</span><span class="r14"> </span><span class="r16">==</span><span class="r14"> </span><span class="r17">&#x27;__main__&#x27;</span><span class="r14">:</span><span class="r9">                                                                     </span>  
 <span class="r6">   225 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    </span><span class="r8"># Use port from environment variable (Render requirement) or default to 5000</span><span class="r9">               </span>  
 <span class="r6">   226 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    </span><span class="r11">import</span><span class="r12"> </span><span class="r13">os</span><span class="r9">                                                                                  </span>  
 <span class="r6">   227 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    port </span><span class="r16">=</span><span class="r14"> </span><span class="r21">int</span><span class="r14">(os</span><span class="r16">.</span><span class="r14">environ</span><span class="r16">.</span><span class="r14">get(</span><span class="r17">&#x27;PORT&#x27;</span><span class="r14">, </span><span class="r16">5000</span><span class="r14">))</span><span class="r9">                                                   </span>  
 <span class="r6">   228 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">    app</span><span class="r16">.</span><span class="r14">run(host</span><span class="r16">=</span><span class="r17">&#x27;0.0.0.0&#x27;</span><span class="r14">, port</span><span class="r16">=</span><span class="r14">port, debug</span><span class="r16">=</span><span class="r11">False</span><span class="r14">)</span><span class="r9">                                            </span>  
 <span class="r6">   229 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r9">                                                                                               </span>  
 <span class="r6">       </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│                                                                                                 
╶───────┼────────┼───────┼───────┼────────────────────────────────────────────────────────────────────────────────────────────────╴
 <span class="r6">       </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r25">function summary for /opt/render/project/src/app.py                                            </span>  
 <span class="r6">   118 </span>│<span class="r18">   28%</span><span class="r7">  </span>│<span class="r7">       </span>│<span class="r7">   5%  </span>│<span class="r14">apply_noise_reduction</span><span class="r9">                                                                          </span>  
 <span class="r6">   176 </span>│<span class="r7">        </span>│<span class="r7">       </span>│<span class="r7">       </span>│<span class="r14">process_image</span><span class="r9">                                                                                  </span>  
        ╵        ╵       ╵       ╵                                                                                                 
generated by the <a class="r26" href="https://github.com/plasma-umass/scalene">scalene</a> profiler                                                                                                   
</code></pre>
</body>
</html>
